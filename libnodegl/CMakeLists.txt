cmake_minimum_required(VERSION 3.14)
project (nodegl)

file (GLOB_RECURSE NODEGL_SRC_FILES *.c *.cpp *.h)

if (NOT ${CMAKE_SYSTEM_NAME} MATCHES "Android")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "android_.*$")
endif()
if (NOT ${CMAKE_SYSTEM_NAME} MATCHES "Windows")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "_wgl.*.c$")
endif()
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "_ios.*.c$")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "jni_")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "vaapi.*$")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "_darwin.*.c$")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "_mediacodec.*.c$")
if ( NOT (${CMAKE_SYSTEM_NAME} MATCHES "Linux" OR ${CMAKE_SYSTEM_NAME} MATCHES "Android"))
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "_egl.*.c$")
endif()
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "gen_specs.c$")
list (FILTER NODEGL_SRC_FILES EXCLUDE REGEX "test_.*.c$")

set (NODEGL_CFLAGS -DBACKEND_GL -DBACKEND_VK -DBACKEND_NGFX -fPIC -g -Wall)
if ( ${CMAKE_SYSTEM_NAME} MATCHES "Linux") 
set (NODEGL_CFLAGS ${NODEGL_CFLAGS} -DHAVE_GLPLATFORM_EGL -DTARGET_LINUX)
set(NODEGL_BUILD_TYPE SHARED)
elseif (${CMAKE_SYSTEM_NAME} MATCHES "Windows")
set (NODEGL_CFLAGS ${NODEGL_CFLAGS} -DHAVE_GLPLATFORM_WGL -DTARGET_WINDOWS)
set(NODEGL_BUILD_TYPE STATIC)
endif()
set (CMAKE_C_STANDARD 11)
add_library(nodegl ${NODEGL_BUILD_TYPE} ${NODEGL_SRC_FILES})
target_compile_options(nodegl PUBLIC ${NODEGL_CFLAGS} ${NGFX_CFLAGS})
target_link_libraries(nodegl PUBLIC 
        ${SXPLAYER_LIBRARIES}
        ${VULKANSDK_LIBRARIES}
        ${SHADERC_LIBRARIES}
        ${GL_LIBRARIES}
        ${NGFX_LIBRARIES}
)
target_link_directories(nodegl PUBLIC 
        ${VULKANSDK_LIBRARY_DIRS}
)
target_include_directories(nodegl PUBLIC 
        ${SXPLAYER_INCLUDE_DIRS}
        ${VULKANSDK_INCLUDE_DIRS}
        ${GL_INCLUDE_DIRS}
        ${NGFX_INCLUDE_DIRS}
)
